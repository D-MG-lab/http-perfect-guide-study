## 2장 URL과 리소스

### 2.1 인터넷의 리소스 탐색하기

#### **URL**(**U**niform **R**esource **L**ocator)은 인터넷 리소스(텍스트, 이미지, 동영상 등 웹에서 사용되는 식별가능한 모든 자원)를 가리키는 표준 이름이다. 
- URL은 브라우저가 정보를 찾는데 필요한 리소스의 위치를 가리키며, URL을 이용해 사람과 애플리케이션이 인터넷상의 수십업개의 리소스를 찾고 사용하며 공유할 수 있다. 
- 그리고 URL을 통해 사람이 HTTP 및 다른 프로토콜을 통해 접근할 수 있다.
- URI(Uniform Resource Identifier) - URL / URN


``` http://www.joes-hardware.com/seasonal/index-fall.html```
- http : URL의 스킴 - 스킴은 웹클라이언트에게 리소스에 어떻게(어떤 프로토콜을 사용해) 접근하는지 알려준다. (http 프로토콜을 사용하도록 알려준다. mailto, rstp, ftp...)
- www . joes-hardware . com : 서버의 위치(호스트 / IP) - 웹클라이언트에게 리소스가 어디에 호스팅되어있는지 알려준다.
- /seasonal/index-fall.html : 리소스의 경로 - 서버의 어떤 특정 리소스가 요청되었는지 알려준다.

**URL을 사용하면 리소스를 일관된 방식으로 지칭할 수 있다. 대부분의 URL은 동일하게 '스킴://서버위치/경로' 구조로 이루어져 있다. 따라서 인터넷상의 모든 리소스를 가리키고 가져오기 위해, 그리고 모든 사람이 같은 방식으로 이름을 써서 리소스를 찾을 수 있도록, 단일 방식의 작명 규칙을 가진 것이다.**



### 2-2. URL 문법

```<scheme>://<user>:<password>@<host>:<port>/<path>;<params>?<query>#<frag> ```
- scheme : 리소스를 가져오려면 어떤 프로토콜을 사용해 서버에 접근해야하는지
- host : 리소스를 호스팅하는 서버의 호스트명 혹은 IP주소
- port : 리소스를 호스팅하는 서버가 열어놓은 포트 번호 
- username/password
- path : 서버 내 리소스가 어디에 위치하는지 / 로 표시
- params : 입력 파라미터 - 이름/값을 쌍으로 가지며 여러개 가질 수 있다. ; 로 구분된다.
- query : 애플리케이션에 파라미터를 전달하는데 사용된다. URL 끝에 ? 로 구분된다.
- frag : 리소스의 일부를 가리킨다. 서버에 전달되지 않고 클라이언트에서만 사용된다. # 로 구분된다.

#### 호스트와 포트 host / port
- 애플리케이션이 인터넷에 있는 리소스를 찾으려면, 리소스를 호스팅하고 있는 장비와 그 장비 내에서 리소스에 접근할 수 있는 서버가 어디에 있는지 알아야 한다. 호스트와 포트 컴포넌트가 이를 알려준다.
- 내부적으로 TCP 프로토콜을 사용하는 HTTP는 기본 포트로 80을 사용한다.

#### 사용자 이름과 비밀번호 username / password
- FTP 스킴은 사용자이름과 비밀번호를 요구한다. default는 'anonymous', chrome에서는 pwd는 'chrome@example.com'으로 설정된다.

#### 경로 path
- 경로 컴포넌트는 리소스가 서버의 어디에 있는지 알려준다. 해당 경로는 아래 예와 같이 계층적 시스템 경로(유닉스 파일 시스템의 파일 경로)와 유사한 구조를 가진다.
- path segment(조각)으로 나뉠 수 있다.

```http://www.joes-hardware.com:80/seasonal/index-fall.html```

#### 파라미터 params
- 파라미터 컴포넌트는 애플리케이션이 서버에 정확학 요청을 보내기 위해 필요한 입력 파라미터를 받는데 사용된다. 

```ftp://prep.ai.mit.edu/pub/gnu;type=d```

```http://www.joeshardware.com/hammers;sale=false/index.html;graphics=true```

#### 쿼리스트링 query strings
- 데이터베이스와 같은 서비스들은 요청 리소스의 범위와 타입을 좁히기 위해 쿼리를 받을 수 있다.
- 아래 예시 URL은 아이템번호12731이 있는지 데이터베이스 게이트웨이로 쿼리하는데에 사용된다.
- 복수개의 쿼리스트링은 & 로 연결된 문자열 형식으로 사용할 수 있다.

```http://www.joes-hardware.com/inventory-check.cgi?item=12731```

#### 프래그먼트 fragment
- 리소스의 특정 부분(조각)을 가리킬 때 프래그먼트 컴포넌트를 사용할 수 있다.
- 일반적으로 HTTP 서버는 객체 일부가 아닌 전체만 다루기 때문에(15장|범위요청에서 다룸) 클라이언트는 서버에 프래그먼트를 전달하지 않는다. 브라우저가 전체 리소스를 내려받은 후, 프래그먼트를 사용하여 보고자 하는 리소스의 일부를 보여준다.


### 2-4. 안전하지 않은 문자
URL은 모든 리소스가 모든 인터넷 프로토콜에서 호환될 수 있도록 설계되었다. 모든 프로토콜이 데이터를 전송하기 위해 서로 다른 장치를 갖고 있기 때문에, 어떤 인터넷 프로토콜을 통해서든 **안전하게 전송 될 수 있도록 URL을 설계**하는 것은 중요했다. 안전한 전송은 **정보가 유실될 위험 없이 URL을 전송할 수 있는 것**을 말한다. 

URL 설계자들은 모든 인터넷 프로토콜로 URL이 전송될 수 있길 바랬고, 가독성도 있기를 바랬다. 따라서 출력이 되지 않거나, 보이지 않는 문자를 사용할 수 있다고 해서, 그리고 그 문자들이 변환된다 하더라도 URL에서 그런 문자들을 사용하는 것은 금지되었다.

여기에 URL은 완벽해야 했다. 알파벳 이외의 문자들이 포함되더라도 이스케이프라는 기능을 추가해 안전하지 않은 문자를 안전한 문자로 인코딩 할 수 있게 했다.

#### URL 문자 집합
컴퓨터 시스템의 기본 문자 집합은 보통 영어 중심으로 설정되어 있다. 따라서 많은 컴퓨터 애플리케이션들이 [US-ASCII](https://ko.wikipedia.org/wiki/ASCII)문자 집합을 사용한다. US-ASCII는 만들어진지 오래되었기 때문에 적은 수의 문자만 포함한다. 비라틴계 언어에 존재하는 문자들까지 지원하기에는 부족하다. 
따라서 URL 설계자들은 URL에 이스케이프 문자열을 쓸 수 있게 설계했다. 이스케이프 문자열은 US-ASCII에서 사용이 금지된 문자들로, 특정 문자나 데이터를 인코딩 할 수 있게 함으로써 이동성과 완성도를 높였다.

#### 인코딩 체계
URL은 안전하지 않은 문자들을 표한하기 위한 인코딩 방법으로 `%`기호를 사용해 ASCII 코드로 표현되는 두 개의 16진수 숫자로 이루어진 '이스케이프'문자로 바꾼다.
|문자|ASCII 코드|URL 예|
|:-:|:-:|:-:|
|~|126 (0x7E)|http://www.joes-hardware.com/%7Ejoe|
|빈 문자|32(0x20)|http://www.joes-hardware.com/more%20tools.html|
|%|37(0x25)|http://www.joes-hardware.com/100%25satisfaction.html|

#### 문자 제한
|문자|선점 및 제한|
|:-:|:-:|
|%|인코딩된 문자에 사용할 이스케이프 토큰으로 선점|
|/|경로 컴포넌트에 있는 경로 세그먼트를 나누는 용도로 선점| 
|.|경로 컴포넌트에서 선점|
|..|경로 컴포넌트에서 선점|
|#|프래그먼트의 구획 문자로 선점|
|?|질의 문자열의 구획 문자로 선점|
|;| 파라미터의 구획 문자로 선점|
|:|스킴, 사용자 이름/ 비밀번호, 호스트/포트의 구획 문자로 선점 |
|$, +|선점|
|@ & =|특정 스킴에서 특별한 의미가 있기 때문에 선점|
|{ } `|` \ ~ [] `|게이트웨이와 같은 전송 에이전트에서 불안전하게 다루기 떄문에 제한됨|
|<> "|안전하지 않음. 웹 문서에서 URL을 구분 지어 표시하듯이,<br> URL 범위 밖에서 역할이 있는 문자이기 떄문에 반드시 인코딩이 필요|
|0x00-0x1F, 0x7F|제한된. 이 16진수 범위에 속하는 문자들은 인쇄되지 않는 US-ASCII 문자다.|
| > 0x7F|제한된. 이 16진수 범위에 속하는 문자들은 7비트 US-ASCII 문자가 아니다.|

#### 좀 더 알아보기
애플리케이션은 정해진 방식대로 구현해야 한다. 어떤 애플리케이션에서 어떤 URL을 보내든지, 그 전에 클라이언트 애플리케이션에서 안전하지 않거나 제한된 문자를 변환하는 것이 좋다.

입력받은 URL에서 어떤 문자를 인코딩해야 하는지 결정하는 데는 브라우저같이 사용자로부터 최초로 URL을 입력받는 애플리케이션에서 하는것이 가장 적절하다. URL을 구성하는 각 컴포넌트마다 사용할 수 있거나 없는 문자들이 있을 것이 있고, 어떤 문자는 스킴에 따라 가용성이 달라지기 때문에 해당 문자들을 직접 입력받는 애플리케이션이야 말로 어떤 문자를 일코딩해야 하는지 결정하기 가장 좋은 위치다.

극단적으로 애플리케이션이 모든 문자를 인코딩하는 방법도 있지만, 이미 안전한 문자들을 인코딩하지 않는 애플리케이션도 있기 때문에 오동작을 일으킬 수 있다.

URL을 해석하는 애플리케이션은 그것을 처리하기 전에 URL을 디코드 해야한다.


### 2-5. 스킴의 바다
|스킴|설명|
|:-:|:-:|
|http|하이퍼텍스트 전송 프로토콜(HyperText Transfer Protocol). 기본 포트 값은 80|
|https|http와 거의 같으나 커넥션의 양 끝단에서 암호화하기 위해 넷스케이프에서 개발한 보안 소켓 계층(Secure Sockets Layer, SSL)을 사용한다는 차이가 있음. 기본 포트 값은 443|
|mailto|이메일 주소를 가리킴.|
|ftp|	파일 전송 프로토콜(File Transfer Protocol)은 FTP 서버에 있는 파일을 내려 받거나 올리고, 디렉터리에 있는 콘텐츠 목록을 가져오는데 사용.|
|rtsp, rtspu|	RTSP URL은 실시간 스트리밍 프로토콜(Real Time Streaming Protocol)을 통해서 읽을 수 있는 오디오 및 비디오와 같은 미디어 리소스 식별자|
|file|	주어진 호스트 기기(로컬 디스크, 네트워크 파일 시스템 등)에서 바로 접근할 수 있는 파일들을 나타냄.|
|news|	특정 문서와 뉴스 그룹에 접근하는데 사용.|
|telnet|	대화형 서비스에 접근하는데 사용|

### 2-6. 미래
URL은 세상에 존재하는 모든 객체에 이름을 지을 수 있고, 새로운 포맷을 쉽게 추가할 수 있게 설계됐다. 인터넷 프로토콜 간 공유할 수 있는 일관된 작명 규칙을 제공한다.

URL도 단점이 있다. URL은 주소이지 실제 이름이 아니기 때문에 리소스가 옮겨지면 URL을 더 사용할 수 없다. 그리고 그 시점에 기존 URL이 갖고 있던 객체를 찾을 방법이 사라진다. 

인터넷 기술 태스크 포스(IETF)는는 URN(Uniform Resource Names)이라는 새로운 표준 작업에 착수했다. URN은 객체가 옮겨지더라도 항상 객체를 가리킬 수 있는 이름을 제공한다. 

지속 통함 자원 지시자(Persistent uniform resource locators, PURL을 사용하면 URL로 URN의 기능을 제공할 수 있다.

#### 지금이 아니면, 언제?
한동안 URN 방식이 활용되었지만 아직 표준화가 되지 않았다. URL에서 URN으로 주소 체계를 바꾸는 것은 매우 큰 작업이고 표준화는 매우 중요한 작업인만큼 준비되려면 시간이 걸리기 때문에 URL은 당분간 계속 사용될 것이다.

URL은 대체할 수 있는 작명 스킴이 나오기 전까지는 계속 사용될 것이다. 다만, 그것을 해결할 수 있는 새로운 표준 같은 것들이 나오고 적용될 것이다. 