# 4.1 TCP 커넥션

전 세계 모든 HTTP 통신은 세계 어디서든 일단 커넥션이 맺어지면 클라이언트 애플리케이션과 서버 애플리케이션 간 손상되지 않은 메시지를 전달할 수 있다.

### **4.1.1 신뢰할 수 있는 데이터 전송 통로인 TCP**

TCP는 충돌 없이 순서에 맞게 HTTP데이터를 전달한다.

- 클라이언트가 서버로 ‘GET/index.html …’를 요청한다면 문자 순서 그대로 전달된다.

### **4.1.2 TCP 스트임은 세그먼트로 나뉘어 IP 패킷을 통해 전송된다**

- HTTP와 HTTPS 네트워크 프로토콜 스택
  ![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/3b20a33e-6695-4820-83df-02d62a909681/Untitled.png)
- TCP는 세그먼트라는 단위로 데이터 스트림을 잘게 나누고, 세그먼트를 IP 패킷이라 불리는 봉투에 담아서 인터넷을 통해 데이터를 전달한다. TCP/IP 소프트웨어에 의해 처리되며, 과정은 HTTP프로그래머에게 보이지 않는다.
- 각 TCP 세그먼트는 하나의 IP주소에서 다른 IP주소로 IP패킷에 담겨 전달된다.
- IP 패킷 헤더(보통 20바이트)
- TCP 세그먼트 헤더(보통 20바이트)
- TCP 데이터 조각(0 혹은 그 이상의 바이트)
- IP헤더는 발신지와 목적지 IP주소, 크기, 기타 플래그를 가진다.
- TCP 세그먼트 헤더는 TCP 포트번호, TCP 제어 플래그, 데이터 순서와 무결성 검사를 위한 숫자 값을 포함한다.

### **4.1.3 TCP 커넥션 유지하기**

- 컴퓨터는 항상 TCP 커넥션을 여러 개 가진다. 네 가지 값으로 식별한다.
- <발신지 IP주소, 발신지 포트, 수신지 IP 주소, 수신지 포트>
- 커넥션들이 같은 목적지 포트 번호를 가리키고 있어도 네가지 커넥션 구성요소를 모두 똑같이 가리키고 있는 커넥션은 있을 수 없다.

### **4.1.4 TCP 소켓 프로그래밍**

- 소켓 API를 사용하면 TCP 엔드포인트 데이터 구조를 생성하고, 원격 서버의 TCP 엔드포인트에 해당 데이터 구조를 연결하여 데이터 스트림을 읽고 쓸 수 있다.
- TCP API는 기본 네트워크 프로토콜의 핸드셰이킹, TCP 데이터 스트림과 IP 패킷 간의 분할 및 재조립에 대한 모든 세부사항을 외부로부터 숨긴다.
