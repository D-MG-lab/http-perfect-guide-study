## 11장 클라이언트 식별과 쿠키

## 1. 개별 접촉

- 현대 웹 사이트들은 개인화된 서비스를 제공하기 위해 사용자들이 브라우징하는 것을 기록하고 싶어한다.
  - 개별 인사
  - 사용자 맞춤 추천
  - 저장된 사용자 정보
  - 세션 추적

## 2. HTTP 헤더

![사용자에 대한 정보를 전달하는 HTTP 헤더](https://user-images.githubusercontent.com/74203440/207076832-1694d8ab-96a5-4912-83d2-c5c8932d6116.png)

- From 헤더
  - 사용자의 이메일 주소를 포함한다. 악의적인 서버가 이메일을 수집하여 스팸 메일 발송하는 문제가 있기 때문에 From 헤더를 보내는 브라우저는 많지 않다.
  - 로봇이나 스파이더가 데이터를 수집하는 과정에서 웹 사이트에 문제를 일으켰을 경우 웹 마스터가 항의 메일을 보낼 수 있도록 From 헤더에 이메일 주소를 기술한다.
- User-Agent 헤더
  - 사용자가 쓰고 있는 브라우저의 이름과 버전 정보, 운영체제 정보까지 포함하여 서버에게 알려준다.
  - 특정 사용자를 식별하는데는 큰 도움이 되지 않는다.
- Referer 헤더
  - 사용자가 현재 페이지로 유입하게 한 웹페이지의 URL을 가리킨다.
  - 사용자를 식별할 수는 없지만 이전에 방문한 페이지를 알려준다.
  - 웹 사용 행태나 사용자의 취향을 더 잘 파악할 수 있다.

## 3. 클라이언트 IP 주소

- 초기에는 클라이언트의 IP주소를 사용하려 했는데, 주소가 잘 바뀌지 않고 웹 서버가 요청마다 클라이언트의 IP를 알 수 있다면 문제없이 동작한다.
- 클라이언트 IP 주소로 사용자를 식별하는 방식은 여러 약점이 있다.
  - 클라이언트 IP 주소는 사용 컴퓨터를 가리키기 때문에 여러 사용자가 같은 컴퓨터를 사용하면 식별이 어렵다.
  - 동적 IP 주소 할당으로 매번 다른 주소를 받기 때문에 웹 서버는 사용자를 IP 주소로 식별할 수 없다.
  - 부족한 주소 관리 때문에 네트워크 주소 변환(Network Address Translation, NAT) 방화벽을 통해 인터넷을 사용한다. 실제 IP 주소를 방화벽 뒤로 숨기고 다른 방화벽 IP 주소로 변환한다.
  - 웹 서버는 클라이언트의 IP 주소 대신 프락시 서버의 IP 주소를 본다. 일부 프락시는 원본 IP 주소를 보존하려 하지만 모든 프락시가 그렇지 않다.
- 인트라넷 같은 제한된 영역에서 특정 IP 주소로부터 오는 사용자에게만 문서를 전달하기도 한다.

## 4. 사용자 로그인

- HTTP는 WWW-Authenticate 와 Authorization 헤더를 사용해 웹 사이트에 사용자 이름을 전달하는 자체적인 체계를 가지고 있고, 브라우저는 사이트로 보내는 모든 요청에 로그인 정보를 함께 보내므로 웹 서버는 로그인 정보를 확인할 수 있다.

## 5. 뚱뚱한 URL

- 사용자의 상태 정보를 포함하는 URL을 뚱뚱한 URL이라고 한다.
  - ex) 식별번호 : 002-1145265-8016838
  - "/exec/obidos/tg/browse/-/229220/ref=gr_gifts/002-1145265-8016838"
- 웹 서버와 통신하는 독립적인 HTTP 트랜잭션을 하나의 '세션' 혹은 '방문'으로 묶는 용도로 뚱뚱한 URL을 사용할 수 있다.
- 사용자가 웹 사이트에 처음 방문하면 유일한 ID가 생성되고, 서버가 인식할 수 있는 방식으로 URL에 추가되며, 서버는 클라이언트를 뚱뚱한 URL로 리다이렉트 시킨다. 서버가 뚱뚱한 URL을 포함한 요청을 받으면 사용자 아이디와 관련된 추가 정보를 찾아서 밖으로 향하는 모든 하이퍼링크를 뚱뚱한 URL로 바꾼다.
- 뚱뚱한 URL에도 문제가 있다.
  - URL이 사용자들에게 혼란을 준다.
  - 공유시에 개인 정보 유출의 위험이 있다.
  - URL이 달라지기 때문에 기존 캐시에 접근 할 수 없다.
  - HTML 페이지를 다시 그려야 해서 서버 부하를 가중시킨다.
  - 다른 사이트로 이동하면 뚱뚱한 URL세션에서 이탈하기 쉽다. 장바구니 같은 것들이 초기화 된다.
  - 로그아웃 시 모든 정보를 잃게 된다.
